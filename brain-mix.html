<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† MIND GAMES - Team Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#0a0a0f;--card:#13131a;--card2:#1a1a24;--gold:#d4af37;--gold2:#f4cf67;--accent:#00d4aa;--accent2:#7c3aed;--text:#e4e4e7;--muted:#71717a;--success:#22c55e;--error:#ef4444;--gradient:linear-gradient(135deg,var(--gold),var(--gold2))}
        body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
        body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(ellipse at top,rgba(212,175,55,0.08),transparent 50%),radial-gradient(ellipse at bottom right,rgba(124,58,237,0.05),transparent 50%);pointer-events:none}
        .container{max-width:800px;margin:0 auto;padding:20px;position:relative;z-index:1}
        .header{text-align:center;padding:30px 0}
        .header h1{font-family:'Space Grotesk',sans-serif;font-size:2.2rem;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-1px;margin-bottom:5px}
        .header p{color:var(--muted);font-size:0.95rem}
        .live-badge{background:rgba(239,68,68,0.2);border:1px solid var(--error);color:var(--error);padding:6px 14px;border-radius:20px;font-size:0.75rem;display:inline-flex;align-items:center;gap:6px;margin-bottom:15px}
        .live-dot{width:8px;height:8px;background:var(--error);border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
        .score-bar{background:var(--card);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 24px;margin-bottom:25px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px}
        .team-info{display:flex;align-items:center;gap:12px}
        .team-name{font-family:'Space Grotesk',sans-serif;color:var(--gold);font-size:1.1rem;font-weight:600}
        .score-display{font-family:'Space Grotesk',sans-serif;font-size:1.4rem;color:var(--accent)}
        .round-pill{background:rgba(212,175,55,0.1);border:1px solid rgba(212,175,55,0.2);padding:8px 18px;border-radius:50px;font-size:0.85rem;color:var(--gold)}
        .screen{display:none}
        .screen.active{display:block;animation:fadeUp .5s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
        .welcome{text-align:center;padding:40px 20px}
        .logo{font-size:4rem;margin-bottom:20px;display:block}
        .tagline{font-size:1.8rem;font-family:'Space Grotesk',sans-serif;color:var(--text);margin-bottom:10px}
        .tagline span{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .game-modes{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:35px 0}
        .mode{background:var(--card);border:1px solid rgba(255,255,255,0.05);border-radius:16px;padding:25px 15px;text-align:center;transition:all .3s}
        .mode:hover{border-color:rgba(212,175,55,0.3);transform:translateY(-3px)}
        .mode-icon{font-size:2rem;margin-bottom:12px;display:block}
        .mode h4{font-family:'Space Grotesk',sans-serif;color:var(--gold);font-size:0.95rem;margin-bottom:6px}
        .mode p{font-size:0.75rem;color:var(--muted);line-height:1.5}
        .input-group{margin:30px 0}
        .input-group label{display:block;margin-bottom:10px;color:var(--muted);font-size:0.9rem}
        .input-group input{background:var(--card2);border:1px solid rgba(255,255,255,0.1);color:var(--text);padding:16px 24px;font-size:1rem;border-radius:12px;width:100%;max-width:320px;text-align:center;transition:all .3s}
        .input-group input:focus{outline:none;border-color:var(--gold);box-shadow:0 0 0 3px rgba(212,175,55,0.1)}
        .btn{font-family:'Space Grotesk',sans-serif;font-size:1rem;padding:16px 40px;border:none;border-radius:12px;cursor:pointer;transition:all .3s;font-weight:600;letter-spacing:0.5px}
        .btn-primary{background:var(--gradient);color:#000;box-shadow:0 4px 20px rgba(212,175,55,0.3)}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(212,175,55,0.4)}
        .btn-secondary{background:transparent;border:1px solid rgba(255,255,255,0.2);color:var(--text)}
        .btn-secondary:hover{border-color:var(--gold);color:var(--gold)}
        .game-card{background:var(--card);border:1px solid rgba(255,255,255,0.05);border-radius:20px;padding:35px;margin-bottom:20px;position:relative}
        .game-type{position:absolute;top:20px;left:25px;font-size:0.75rem;text-transform:uppercase;letter-spacing:2px;color:var(--muted)}
        .round-num{position:absolute;top:20px;right:25px;font-family:'Space Grotesk',sans-serif;color:var(--gold);font-size:0.9rem}
        .question-area{margin:50px 0 30px;text-align:center}
        .question-text{font-size:1.4rem;line-height:1.7;color:var(--text);max-width:600px;margin:0 auto}
        .question-text.large{font-size:1.6rem}
        .stat-display{background:var(--card2);border-radius:16px;padding:30px;margin:25px auto;max-width:400px;text-align:center}
        .stat-label{color:var(--muted);font-size:0.85rem;margin-bottom:8px}
        .stat-value{font-family:'Space Grotesk',sans-serif;font-size:2.5rem;color:var(--gold)}
        .stat-unit{color:var(--muted);font-size:1rem;margin-left:5px}
        .vs-text{font-family:'Space Grotesk',sans-serif;font-size:1.2rem;color:var(--muted);margin:20px 0}
        .compare-item{background:var(--card2);border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:20px;margin:10px 0;text-align:center;font-size:1.1rem}
        .options{display:grid;gap:12px;max-width:500px;margin:30px auto}
        .option{background:var(--card2);border:2px solid rgba(255,255,255,0.08);color:var(--text);padding:18px 24px;border-radius:14px;font-size:1rem;cursor:pointer;transition:all .3s;text-align:left;display:flex;align-items:center;gap:15px}
        .option:hover{border-color:rgba(212,175,55,0.4);background:rgba(212,175,55,0.05)}
        .option.selected{border-color:var(--gold);background:rgba(212,175,55,0.1)}
        .option.correct{border-color:var(--success);background:rgba(34,197,94,0.15)}
        .option.wrong{border-color:var(--error);background:rgba(239,68,68,0.15)}
        .option-letter{width:36px;height:36px;background:rgba(255,255,255,0.05);border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:0.9rem;flex-shrink:0}
        .option.selected .option-letter{background:var(--gold);color:#000}
        .option.correct .option-letter{background:var(--success);color:#fff}
        .option.wrong .option-letter{background:var(--error);color:#fff}
        .hl-buttons{display:flex;justify-content:center;gap:20px;margin:30px 0}
        .hl-btn{padding:20px 50px;border-radius:14px;font-family:'Space Grotesk',sans-serif;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s;border:2px solid transparent}
        .hl-btn.higher{background:rgba(34,197,94,0.1);border-color:var(--success);color:var(--success)}
        .hl-btn.higher:hover{background:var(--success);color:#fff}
        .hl-btn.lower{background:rgba(239,68,68,0.1);border-color:var(--error);color:var(--error)}
        .hl-btn.lower:hover{background:var(--error);color:#fff}
        .hl-btn.selected{transform:scale(1.05)}
        .hl-btn.correct{background:var(--success)!important;color:#fff!important;border-color:var(--success)!important}
        .hl-btn.wrong{background:var(--error)!important;color:#fff!important;border-color:var(--error)!important}
        .wyr-options{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:30px 0}
        .wyr-option{background:var(--card2);border:2px solid rgba(255,255,255,0.08);border-radius:16px;padding:30px 20px;text-align:center;cursor:pointer;transition:all .3s;min-height:150px;display:flex;flex-direction:column;justify-content:center}
        .wyr-option:hover{border-color:rgba(212,175,55,0.4)}
        .wyr-option.selected{border-color:var(--gold);background:rgba(212,175,55,0.1)}
        .wyr-option h4{font-family:'Space Grotesk',sans-serif;color:var(--gold);font-size:0.85rem;margin-bottom:10px}
        .wyr-option p{font-size:0.95rem;line-height:1.5;color:var(--text)}
        .wyr-result{margin-top:15px;font-family:'Space Grotesk',sans-serif;font-size:1.1rem}
        .feedback{padding:16px 24px;border-radius:12px;margin:20px 0;text-align:center;font-size:1rem;font-weight:600;display:none}
        .feedback.show{display:block;animation:pop .4s ease}
        .feedback.success{background:rgba(34,197,94,0.15);border:1px solid var(--success);color:var(--success)}
        .feedback.error{background:rgba(239,68,68,0.15);border:1px solid var(--error);color:var(--error)}
        .feedback.info{background:rgba(212,175,55,0.15);border:1px solid var(--gold);color:var(--gold)}
        @keyframes pop{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
        .answer-reveal{background:var(--card2);border-radius:12px;padding:20px;margin:20px 0;text-align:center;display:none}
        .answer-reveal.show{display:block}
        .answer-reveal .label{color:var(--muted);font-size:0.8rem;margin-bottom:5px}
        .answer-reveal .value{font-family:'Space Grotesk',sans-serif;font-size:1.8rem;color:var(--accent)}
        .btn-row{text-align:center;margin-top:25px}
        .leaderboard{background:var(--card);border:1px solid rgba(255,255,255,0.05);border-radius:16px;padding:25px;margin-top:30px}
        .leaderboard h3{font-family:'Space Grotesk',sans-serif;color:var(--gold);text-align:center;font-size:1.1rem;margin-bottom:20px;letter-spacing:1px}
        .lb-table{width:100%;border-collapse:collapse}
        .lb-table th,.lb-table td{padding:12px;text-align:center;font-size:0.9rem}
        .lb-table th{color:var(--muted);font-weight:400;border-bottom:1px solid rgba(255,255,255,0.05)}
        .lb-table td{border-bottom:1px solid rgba(255,255,255,0.03)}
        .rank-1 td{color:var(--gold)!important}
        .rank-2 td{color:#c0c0c0!important}
        .rank-3 td{color:#cd7f32!important}
        .victory{text-align:center;padding:50px 20px}
        .victory-icon{font-size:5rem;margin-bottom:20px;display:block}
        .victory h2{font-family:'Space Grotesk',sans-serif;font-size:2rem;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}
        .final-score{font-family:'Space Grotesk',sans-serif;font-size:4rem;color:var(--gold);margin:30px 0}
        .final-score span{font-size:1.5rem;color:var(--muted)}
        .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;max-width:450px;margin:30px auto}
        .stat-box{background:var(--card);border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:20px}
        .stat-box .num{font-family:'Space Grotesk',sans-serif;font-size:1.8rem;color:var(--accent)}
        .stat-box .lbl{color:var(--muted);font-size:0.8rem;margin-top:5px}
        @media(max-width:768px){.game-modes{grid-template-columns:1fr}.wyr-options{grid-template-columns:1fr}.hl-buttons{flex-direction:column;align-items:center}.stats-grid{grid-template-columns:1fr}}
        .confetti{position:fixed;width:8px;height:8px;top:-10px;pointer-events:none;animation:confettiFall 4s linear forwards}
        @keyframes confettiFall{to{transform:translateY(105vh) rotate(720deg);opacity:0}}
    </style>
</head>
<body>
<div class="container">
    <header class="header">
        <h1>MIND GAMES</h1>
        <p>Think Fast. Think Smart. Win Big.</p>
        <div class="live-badge"><span class="live-dot"></span>LIVE LEADERBOARD</div>
    </header>
    
    <div class="score-bar" id="score-bar" style="display:none">
        <div class="team-info">
            <span class="team-name" id="team-display">Team</span>
        </div>
        <div class="score-display">Score: <span id="score">0</span></div>
        <div class="round-pill">Round <span id="round-num">1</span>/21</div>
    </div>

    <!-- WELCOME -->
    <div class="screen active" id="welcome">
        <div class="welcome">
            <span class="logo">üß†</span>
            <h2 class="tagline">2 Games. <span>21 Rounds.</span> ROAST Your Team!</h2>
            <div class="game-modes">
                <div class="mode">
                    <span class="mode-icon">üòÇ</span>
                    <h4>FUNNY RIDDLES</h4>
                    <p>Jokes, puns, and hilarious brain teasers!</p>
                </div>
                <div class="mode">
                    <span class="mode-icon">‚öñÔ∏è</span>
                    <h4>TEAM ROAST</h4>
                    <p>Escape with your teammates! Hilarious scenarios!</p>
                </div>
                <div class="mode">
                    <span class="mode-icon">üéâ</span>
                    <h4>ALL ABOUT FUN</h4>
                    <p>No boring stuff. Just laughs!</p>
                </div>
            </div>
            <div class="input-group">
                <label>Enter your team name</label>
                <input type="text" id="teamName" placeholder="e.g., Big Brains" maxlength="25">
            </div>
            <button class="btn btn-primary" onclick="startGame()">Start Challenge</button>
            <div class="leaderboard" id="welcome-lb">
                <h3>üèÜ LIVE LEADERBOARD</h3>
                <table class="lb-table"><thead><tr><th>Rank</th><th>Team</th><th>Score</th></tr></thead><tbody id="lb-body"><tr><td colspan="3" style="color:var(--muted);padding:25px">Loading...</td></tr></tbody></table>
            </div>
        </div>
    </div>

    <!-- GAME -->
    <div class="screen" id="game">
        <div class="game-card" id="game-card">
            <span class="game-type" id="game-type">LATERAL THINKING</span>
            <span class="round-num" id="round-display">01/15</span>
            <div class="question-area" id="question-area"></div>
            <div class="feedback" id="feedback"></div>
            <div class="answer-reveal" id="answer-reveal"></div>
            <div class="btn-row" id="btn-row"></div>
        </div>
    </div>

    <!-- VICTORY -->
    <div class="screen" id="victory">
        <div class="victory">
            <span class="victory-icon">üèÜ</span>
            <h2>Challenge Complete!</h2>
            <p style="color:var(--muted)"><span id="winner"></span></p>
            <div class="final-score"><span id="final-score">0</span> <span>pts</span></div>
            <div class="stats-grid">
                <div class="stat-box"><div class="num" id="v-correct">0</div><div class="lbl">Correct</div></div>
                <div class="stat-box"><div class="num" id="v-streak">0</div><div class="lbl">Best Streak</div></div>
                <div class="stat-box"><div class="num" id="v-time">0:00</div><div class="lbl">Time</div></div>
            </div>
            <div style="margin-top:25px;padding:20px;background:rgba(255,255,255,0.05);border-radius:12px;border:1px solid rgba(255,255,255,0.1);max-width:500px;margin-left:auto;margin-right:auto">
                <p style="font-size:1.3rem;margin:8px 0">üëë <strong>SAHIL:</strong> "Good. Now get back to work!" üòà</p>
                <p style="font-size:1.1rem;margin:8px 0">üìã <strong>SONU:</strong> "Where's the RCA for this escape?"</p>
            </div>
            <div style="margin-top:30px">
                <button class="btn btn-primary" onclick="playAgain()">Play Again</button>
                <button class="btn btn-secondary" onclick="showFinalLB()" style="margin-left:10px">Leaderboard</button>
            </div>
            <div class="leaderboard" id="final-lb" style="display:none;margin-top:30px">
                <h3>üèÜ LIVE LEADERBOARD</h3>
                <table class="lb-table"><thead><tr><th>Rank</th><th>Team</th><th>Score</th></tr></thead><tbody id="final-lb-body"></tbody></table>
            </div>
        </div>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// üî• FIREBASE CONFIG
const firebaseConfig = {
    apiKey: "AIzaSyBRX_8Vj4o2_9u0qLOMlIErdDo9Fndp7oE",
    authDomain: "officeolympics-e2397.firebaseapp.com",
    projectId: "officeolympics-e2397",
    storageBucket: "officeolympics-e2397.firebasestorage.app",
    messagingSenderId: "1074657740174",
    appId: "1:1074657740174:web:634e34f95dd17b480cd0df"
};

// Initialize Firebase
let db = null;
try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    console.log('‚úÖ Firebase connected');
} catch(e) {
    console.warn('‚ö†Ô∏è Firebase not configured, using local storage');
}

const ROUNDS = [
    {type:'lateral',question:'Why do programmers prefer dark mode?',options:['To save battery','Because light attracts bugs! üêõ','It looks cool','Easier on eyes'],answer:1,explanation:'Because light attracts bugs! üêõüí°',points:100},
    {type:'lateral',question:'What do you call a fake noodle?',options:['A pasta','An impasta! üçù','A fake-aroni','Noodlen\'t'],answer:1,explanation:'An impasta! üçùüòÑ (Impostor + Pasta)',points:100},
    {type:'lateral',question:'Why did the bicycle fall over?',options:['It was broken','It was too tired! üò¥','Someone pushed it','It had no stand'],answer:1,explanation:'It was two-tired! üò¥üö≤ (Too tired!)',points:100},
    {type:'lateral',question:'What do you call cheese that isn\'t yours?',options:['Stolen cheese','Nacho cheese! üßÄ','Someone\'s cheese','Fake cheese'],answer:1,explanation:'Nacho cheese! üßÄüòÇ (Not your cheese!)',points:100},
    {type:'lateral',question:'Why can\'t you trust stairs?',options:['They shake','They\'re always up to something! üòè','They break','They\'re old'],answer:1,explanation:'They\'re always up to something! üòè',points:100},
    {type:'lateral',question:'What did the ocean say to the beach?',options:['Hello!','Nothing, it just waved! üåä','Goodbye!','Help me!'],answer:1,explanation:'Nothing, it just waved! üåäüòÑ',points:150},
    {type:'lateral',question:'Why did the math book look sad?',options:['It failed','It was old','Because it had too many problems! üìö','No one read it'],answer:2,explanation:'Because it had too many problems! üìöüò¢',points:150},
    {type:'lateral',question:'What do you call a bear with no teeth?',options:['A scary bear','A gummy bear! üêª','A sad bear','A toothless bear'],answer:1,explanation:'A gummy bear! üêªüç¨',points:150},
    {type:'lateral',question:'Why don\'t scientists trust atoms?',options:['They\'re small','They make up everything! ‚öõÔ∏è','They\'re unstable','They\'re invisible'],answer:1,explanation:'Because they make up everything! ‚öõÔ∏èüòÇ',points:150},
    {type:'lateral',question:'What did one wall say to the other wall?',options:['Hello','Nothing','I\'ll meet you at the corner! üìê','Goodbye'],answer:2,explanation:'I\'ll meet you at the corner! üìêüòÑ',points:150},
    {type:'wyr',optionA:'Escape with SONU (write RCA for every step!) üìã',optionB:'Escape with TANVEER (3-hour route explanation!) üìö',points:50},
    {type:'wyr',optionA:'Call HARJEET for help (OMS architecture tour!) üèõÔ∏è',optionB:'Call ARSHAAN for help (OMS + Harjeet = 4 hours!) üí•',points:50},
    {type:'wyr',optionA:'Team up with ANUJ (always busy, never free!) üëª',optionB:'Team up with SRK (sprint planning the escape!) üé¨',points:50},
    {type:'wyr',optionA:'Ask NIDHI for help (CRM queen knows everything!) üë∏',optionB:'Ask MOHAMMAD SARAHNI for help (CRM wizard!) ‚ö°',points:50},
    {type:'wyr',optionA:'Partner with NEHA ("I told you we\'d get stuck!") üìß',optionB:'Partner with GURLEEN ("Which door was it?") ü§Ø',points:50},
    {type:'wyr',optionA:'Get rescued by Testing Team: PRATIK üéØ',optionB:'Get rescued by Testing Team: SHASHANK (47 questions!) üîç',points:50},
    {type:'wyr',optionA:'Testing help from SAIPUJITHA (finds all bugs!) üêõ',optionB:'Testing help from ANNA/SUMANTH (pronunciation first!) üôè',points:50},
    {type:'wyr',optionA:'Escape with SAKSHI S. or SAKSHI M.? (Which?!) üëØ',optionB:'Escape with SVO Squad: JATIN + RISHABH! üéÆ',points:50},
    {type:'wyr',optionA:'Ask TANMAY ("Yaar I\'m not a fresher!") üò§',optionB:'Ask LOIZOS (international escape expert!) üåç',points:50},
    {type:'wyr',optionA:'Final call to SAHIL (heart rate üìà, everyone panics!)',optionB:'Escape during 8 PM CHECKPOINT (pure survival!) üåô',points:50},
    {type:'wyr',optionA:'Mission accomplished! SAHIL: "Good, now back to work!" üòà',optionB:'Mission accomplished! SONU: "Where\'s the escape RCA?" üìã',points:50}
];

let G = { team:'',round:0,score:0,correct:0,streak:0,bestStreak:0,startTime:null,selected:null,answered:false };

function loadLB() {
    if (db) {
        db.collection('leaderboard').orderBy('score', 'desc').limit(10).onSnapshot((snapshot) => {
            const scores = [];
            snapshot.forEach((doc) => scores.push(doc.data()));
            updateLB(scores, 'lb-body');
        });
    } else {
        const l = JSON.parse(localStorage.getItem('mindGamesV1') || '[]');
        updateLB(l, 'lb-body');
    }
}

function updateLB(l, id) {
    const t = document.getElementById(id);
    if (!l.length) {
        t.innerHTML = '<tr><td colspan="3" style="color:var(--muted);padding:25px">No teams yet</td></tr>';
        return;
    }
    l.sort((a, b) => b.score - a.score);
    t.innerHTML = l.slice(0,10).map((e, i) => `
        <tr class="${i < 3 ? 'rank-' + (i + 1) : ''}">
            <td>${['ü•á', 'ü•à', 'ü•â'][i] || (i + 1)}</td>
            <td>${e.name}</td>
            <td>${e.score}</td>
        </tr>
    `).join('');
}

function startGame() {
    const name = document.getElementById('teamName').value.trim();
    if (!name) {
        document.getElementById('teamName').style.borderColor = 'var(--error)';
        document.getElementById('teamName').placeholder = 'Please enter a name';
        return;
    }
    
    G = { team: name, round: 0, score: 0, correct: 0, streak: 0, bestStreak: 0, startTime: Date.now(), selected: null, answered: false };
    
    document.getElementById('score-bar').style.display = 'flex';
    document.getElementById('team-display').textContent = name;
    document.getElementById('score').textContent = '0';
    
    loadRound();
}

function loadRound() {
    if (G.round >= ROUNDS.length) {
        endGame();
        return;
    }
    
    const r = ROUNDS[G.round];
    G.selected = null;
    G.answered = false;
    
    document.getElementById('round-num').textContent = G.round + 1;
    document.getElementById('round-display').textContent = `${String(G.round + 1).padStart(2, '0')}/${ROUNDS.length}`;
    document.getElementById('feedback').className = 'feedback';
    document.getElementById('answer-reveal').className = 'answer-reveal';
    
    const typeLabels = { 'lateral': 'üòÇ FUNNY RIDDLE', 'wyr': '‚öñÔ∏è WOULD YOU RATHER' };
    document.getElementById('game-type').textContent = typeLabels[r.type];
    
    const qa = document.getElementById('question-area');
    const br = document.getElementById('btn-row');
    
    if (r.type === 'lateral') {
        qa.innerHTML = `
            <p class="question-text">${r.question}</p>
            <div class="options" id="options">
                ${r.options.map((o, i) => `
                    <div class="option" onclick="selectOption(${i})" data-idx="${i}">
                        <span class="option-letter">${['A', 'B', 'C', 'D'][i]}</span>
                        <span>${o}</span>
                    </div>
                `).join('')}
            </div>
        `;
        br.innerHTML = `<button class="btn btn-primary" onclick="submitLateral()">Submit Answer</button>`;
    }
    else if (r.type === 'higher-lower') {
        qa.innerHTML = `
            <div class="stat-display">
                <div class="stat-label">${r.item1.name}</div>
                <div class="stat-value">${r.item1.value.toLocaleString()} <span class="stat-unit">${r.unit1}</span></div>
            </div>
            <p class="vs-text">Is this <strong>HIGHER</strong> or <strong>LOWER</strong> than...</p>
            <div class="compare-item">${r.item2.name}</div>
            <div class="hl-buttons" id="hl-buttons">
                <button class="hl-btn higher" onclick="selectHL('higher')">‚Üë HIGHER</button>
                <button class="hl-btn lower" onclick="selectHL('lower')">‚Üì LOWER</button>
            </div>
        `;
        br.innerHTML = `<button class="btn btn-primary" onclick="submitHL()">Lock Answer</button>`;
    }
    else if (r.type === 'wyr') {
        qa.innerHTML = `
            <p class="question-text large">Would you rather...</p>
            <div class="wyr-options">
                <div class="wyr-option" onclick="selectWYR('A')" data-opt="A">
                    <h4>OPTION A</h4>
                    <p>${r.optionA}</p>
                </div>
                <div class="wyr-option" onclick="selectWYR('B')" data-opt="B">
                    <h4>OPTION B</h4>
                    <p>${r.optionB}</p>
                </div>
            </div>
        `;
        br.innerHTML = `<button class="btn btn-primary" onclick="submitWYR()">Lock Choice</button>`;
    }
    
    show('game');
}

function selectOption(idx) {
    if (G.answered) return;
    document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
    document.querySelector(`.option[data-idx="${idx}"]`).classList.add('selected');
    G.selected = idx;
}

function selectHL(choice) {
    if (G.answered) return;
    document.querySelectorAll('.hl-btn').forEach(b => b.classList.remove('selected'));
    document.querySelector(`.hl-btn.${choice}`).classList.add('selected');
    G.selected = choice;
}

function selectWYR(opt) {
    if (G.answered) return;
    document.querySelectorAll('.wyr-option').forEach(o => o.classList.remove('selected'));
    document.querySelector(`.wyr-option[data-opt="${opt}"]`).classList.add('selected');
    G.selected = opt;
}

function submitLateral() {
    if (G.answered) { nextRound(); return; }
    if (G.selected === null) { showFeedback('error', 'Please select an answer'); return; }
    G.answered = true;
    const r = ROUNDS[G.round];
    const isCorrect = G.selected === r.answer;
    document.querySelectorAll('.option').forEach((o, i) => {
        o.style.pointerEvents = 'none';
        if (i === r.answer) o.classList.add('correct');
        else if (i === G.selected) o.classList.add('wrong');
    });
    if (isCorrect) {
        G.score += r.points; G.correct++; G.streak++; 
        if (G.streak > G.bestStreak) G.bestStreak = G.streak;
        document.getElementById('score').textContent = G.score;
        showFeedback('success', `+${r.points} points!`);
    } else { G.streak = 0; showFeedback('error', 'Not quite right'); }
    document.getElementById('answer-reveal').innerHTML = `<div class="label">Answer</div><div class="value">${r.explanation}</div>`;
    document.getElementById('answer-reveal').classList.add('show');
    document.getElementById('btn-row').innerHTML = `<button class="btn btn-primary" onclick="nextRound()">Next Round ‚Üí</button>`;
}

function submitHL() {
    if (G.answered) { nextRound(); return; }
    if (G.selected === null) { showFeedback('error', 'Make your choice'); return; }
    G.answered = true;
    const r = ROUNDS[G.round];
    const correctAnswer = r.item1.value > r.item2.value ? 'higher' : 'lower';
    const isCorrect = G.selected === correctAnswer;
    document.querySelectorAll('.hl-btn').forEach(b => {
        b.style.pointerEvents = 'none';
        if (b.classList.contains(correctAnswer)) b.classList.add('correct');
        else if (b.classList.contains(G.selected)) b.classList.add('wrong');
    });
    if (isCorrect) {
        G.score += r.points; G.correct++; G.streak++;
        if (G.streak > G.bestStreak) G.bestStreak = G.streak;
        document.getElementById('score').textContent = G.score;
        showFeedback('success', `+${r.points} points!`);
    } else { G.streak = 0; showFeedback('error', 'Wrong guess!'); }
    document.getElementById('answer-reveal').innerHTML = `<div class="label">${r.item2.name}</div><div class="value">${r.item2.value.toLocaleString()} ${r.unit2}</div>`;
    document.getElementById('answer-reveal').classList.add('show');
    document.getElementById('btn-row').innerHTML = `<button class="btn btn-primary" onclick="nextRound()">Next Round ‚Üí</button>`;
}

function submitWYR() {
    if (G.answered) { nextRound(); return; }
    if (G.selected === null) { showFeedback('error', 'Make your choice'); return; }
    G.answered = true;
    const r = ROUNDS[G.round];
    G.score += r.points; G.correct++;
    document.getElementById('score').textContent = G.score;
    showFeedback('info', `+${r.points} points! Bold choice üòè`);
    document.getElementById('btn-row').innerHTML = `<button class="btn btn-primary" onclick="nextRound()">Next Round ‚Üí</button>`;
}

function nextRound() { G.round++; loadRound(); }
function showFeedback(type, msg) {
    const fb = document.getElementById('feedback');
    fb.className = `feedback show ${type}`;
    fb.textContent = msg;
}

function endGame() {
    const elapsed = Math.floor((Date.now() - G.startTime) / 1000);
    const timeStr = `${Math.floor(elapsed / 60)}:${String(elapsed % 60).padStart(2, '0')}`;
    
    // Save to Firebase or localStorage
    if (db) {
        db.collection('leaderboard').add({
            name: G.team,
            score: G.score,
            time: timeStr,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => console.log('Score saved to Firebase'));
    } else {
        const scores = JSON.parse(localStorage.getItem('mindGamesV1') || '[]');
        scores.push({ name: G.team, score: G.score, time: timeStr, ts: Date.now() });
        localStorage.setItem('mindGamesV1', JSON.stringify(scores));
    }
    
    document.getElementById('score-bar').style.display = 'none';
    document.getElementById('winner').textContent = G.team;
    document.getElementById('final-score').textContent = G.score;
    document.getElementById('v-correct').textContent = G.correct + '/' + ROUNDS.length;
    document.getElementById('v-streak').textContent = G.bestStreak;
    document.getElementById('v-time').textContent = timeStr;
    
    show('victory');
    confetti();
}

function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function confetti() {
    const colors = ['#d4af37', '#f4cf67', '#00d4aa', '#7c3aed', '#22c55e'];
    for (let i = 0; i < 60; i++) {
        setTimeout(() => {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.left = Math.random() * 100 + 'vw';
            c.style.background = colors[Math.floor(Math.random() * colors.length)];
            c.style.animationDuration = (Math.random() * 2 + 2) + 's';
            document.body.appendChild(c);
            setTimeout(() => c.remove(), 4000);
        }, i * 40);
    }
}

function showFinalLB() {
    if (db) {
        db.collection('leaderboard').orderBy('score', 'desc').limit(10).get().then((snapshot) => {
            const scores = [];
            snapshot.forEach((doc) => scores.push(doc.data()));
            updateLB(scores, 'final-lb-body');
        });
    } else {
        const l = JSON.parse(localStorage.getItem('mindGamesV1') || '[]');
        updateLB(l, 'final-lb-body');
    }
    document.getElementById('final-lb').style.display = 'block';
}

function playAgain() {
    document.getElementById('teamName').value = '';
    document.getElementById('teamName').style.borderColor = '';
    document.getElementById('final-lb').style.display = 'none';
    show('welcome');
    loadLB();
}

window.onload = loadLB;
</script>
</body>
</html>
